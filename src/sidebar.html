<style>
  /* ===============================================
   ã‚µã‚¤ãƒ‰ãƒãƒ¼ (ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼) ã‚¹ã‚¿ã‚¤ãƒ«
   =============================================== */

  .hamburger-btn {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background-color: transparent;
    color: #ffffff;
    border-radius: 8px;
    cursor: pointer;
    z-index: 1040;
    border: none;
    transition: all 0.2s ease;
  }

  .hamburger-btn:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }

  .hamburger-btn i {
    font-size: 1.4rem;
  }

  /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤èƒŒæ™¯ */
  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1045;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
  }

  /* ã‚µã‚¤ãƒ‰ãƒãƒ¼æœ¬ä½“ */
  .sidebar-menu {
    position: fixed;
    top: 0;
    left: -320px;
    width: 280px;
    max-width: 85vw;
    height: 100vh;
    background-color: #f8fafc;
    z-index: 1050;
    overflow-y: auto;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
  }

  .sidebar-menu.show {
    left: 0;
  }

  /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ */
  .sidebar-header {
    padding: 20px;
    background: linear-gradient(135deg, #4a90a4 0%, #3d7a8c 100%);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .sidebar-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0;
  }

  .sidebar-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
    opacity: 0.8;
    transition: opacity 0.2s;
  }

  .sidebar-close:hover {
    opacity: 1;
  }

  /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
  .sidebar-content {
    padding: 10px;
    flex: 1;
  }

  /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼šhome.htmlã¨åŒã˜ãƒ‡ã‚¶ã‚¤ãƒ³ */
  .sb-section {
    margin-bottom: 6px;
    border-radius: 10px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šhome.htmlã® .menu-header ã«åˆã‚ã›ãŸã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
  .sb-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: linear-gradient(135deg, #4a90a4 0%, #3d7a8c 100%);
    color: #fff;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s;
  }

  .sb-header:hover {
    background: linear-gradient(135deg, #3d7a8c 0%, #2d6a7c 100%);
  }

  /* ã€Œå‚ç…§ã€ã€Œãã®ä»–ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã®è½ã¡ç€ã„ãŸè‰² */
  .sb-header-util {
    background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
  }

  .sb-header-util:hover {
    background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
  }

  .sb-arrow {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
  }

  .sb-header.collapsed .sb-arrow {
    transform: rotate(-90deg);
  }

  .sb-body {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
    background-color: #f8fafc;
    padding: 8px;
  }

  .sb-body.collapsed {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
  }

  /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */
  .sb-btn {
    display: block;
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 4px;
    background: transparent;
    color: #475569;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    text-align: left;
    transition: all 0.2s;
    cursor: pointer;
  }

  .sb-btn:hover {
    background-color: #e0f2fe;
    color: #0369a1;
  }

  /* å‚ç…§ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
  .sb-link {
    display: block;
    width: 100%;
    padding: 8px 12px;
    margin-bottom: 2px;
    color: #64748b;
    font-size: 0.85rem;
    text-decoration: none;
    border-radius: 4px;
    transition: background-color 0.2s;
    background: transparent;
    border: none;
    text-align: left;
    cursor: pointer;
  }

  .sb-link:hover {
    background-color: #f1f5f9;
    color: #0f172a;
  }
</style>

<!-- ==============================================
     ã‚µã‚¤ãƒ‰ãƒãƒ¼ HTML æ§‹é€ 
     ============================================== -->
<button type="button" class="hamburger-btn" id="openSidebarBtn" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
  <i class="bi bi-list"></i>
</button>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<div class="sidebar-menu" id="sidebarMenu">
  <div class="sidebar-header">
    <h3 class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
    <button type="button" class="sidebar-close" id="closeSidebarBtn">&times;</button>
  </div>

  <div class="sidebar-content">
    <!-- POSTé€ä¿¡ç”¨éš ã—ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="sidebarNavForm" method="POST" action="<?= typeof deployURL !== 'undefined' ? deployURL : '' ?>"
      style="display: none;">
      <input type="hidden" name="sessionId" value="<?= typeof sessionId !== 'undefined' ? sessionId : '' ?>">
      <input type="hidden" id="sidebarNavTarget" name="" value="true">
    </form>

    <? if (typeof userRole !== 'undefined' && userRole !== 'viewer') { ?>
    <div class="sb-section">
      <div class="sb-header" onclick="toggleSbSection(this)">
        <span>ğŸ“ å—æ³¨</span><span class="sb-arrow">â–¼</span>
      </div>
      <div class="sb-body">
        <button type="button" class="sb-btn" onclick="navTo('shipping')">ğŸ“ å—æ³¨å…¥åŠ›</button>
        <button type="button" class="sb-btn" onclick="navTo('phoneOrder')">ğŸ“ é›»è©±å—æ³¨</button>
        <button type="button" class="sb-btn" onclick="navTo('csvImport')">ğŸ“¥ CSVå–è¾¼</button>
        <button type="button" class="sb-btn" onclick="navTo('masterImport')">ğŸ“‹ ä¸€æ‹¬ãƒã‚¹ã‚¿ç™»éŒ²</button>
      </div>
    </div>
    <? } ?>

    <div class="sb-section">
      <div class="sb-header" onclick="toggleSbSection(this)">
        <span>ğŸ“Š ä¸€è¦§</span><span class="sb-arrow">â–¼</span>
      </div>
      <div class="sb-body">
        <button type="button" class="sb-btn" onclick="navTo('orderListPage')">ğŸ“‘ å—æ³¨ä¸€è¦§</button>
        <button type="button" class="sb-btn" onclick="navTo('orderList')">ğŸ“Š è£½é€ æ•°ä¸€è¦§</button>
        <button type="button" class="sb-btn" onclick="navTo('manufacturingOrder')">ğŸ“‹ è£½é€ æŒ‡ç¤ºæ›¸</button>
        <? if (typeof userRole !== 'undefined' && userRole === 'admin') { ?>
        <button type="button" class="sb-btn" onclick="navTo('salesDashboard')">ğŸ“ˆ å£²ä¸Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
        <? } ?>
        <? if (typeof userRole !== 'undefined' && userRole !== 'viewer') { ?>
        <button type="button" class="sb-btn" onclick="navTo('recurringOrderList')">ğŸ”„ å®šæœŸä¾¿ä¸€è¦§</button>
        <button type="button" class="sb-btn" onclick="navTo('aiImportList')">ğŸ¤– AIå–è¾¼ä¸€è¦§</button>
        <? } ?>
        <? if (typeof userRole !== 'undefined' && userRole === 'admin') { ?>
        <button type="button" class="sb-btn" onclick="navTo('productList')">ğŸ›ï¸ å•†å“ãƒã‚¹ã‚¿</button>
        <button type="button" class="sb-btn" onclick="navTo('customerList')">ğŸ‘¥ é¡§å®¢ãƒã‚¹ã‚¿</button>
        <button type="button" class="sb-btn" onclick="navTo('shippingToList')">ğŸ“¦ ç™ºé€å…ˆãƒã‚¹ã‚¿</button>
        <? } ?>
      </div>
    </div>

    <? if (typeof userRole !== 'undefined' && userRole !== 'viewer') { ?>
    <div class="sb-section">
      <div class="sb-header" onclick="toggleSbSection(this)">
        <span>ğŸ› ï¸ ä½œæˆ</span><span class="sb-arrow">â–¼</span>
      </div>
      <div class="sb-body">
        <button type="button" class="sb-btn" onclick="navTo('createShippingSlips')">ğŸ“¦ é€ã‚ŠçŠ¶ä½œæˆ</button>
        <button type="button" class="sb-btn" onclick="navTo('createBill')">ğŸ’° è«‹æ±‚æ›¸ä½œæˆ</button>
        <button type="button" class="sb-btn" onclick="navTo('createFreeeDeliveryNote')">ğŸ“Š freeeç´å“æ›¸CSV</button>
        <button type="button" class="sb-btn" onclick="navTo('quotation')">ğŸ“‹ è¦‹ç©æ›¸ä½œæˆ</button>
      </div>
    </div>

    <div class="sb-section">
      <div class="sb-header sb-header-util" onclick="toggleSbSection(this)">
        <span>ğŸ” å‚ç…§</span><span class="sb-arrow">â–¼</span>
      </div>
      <div class="sb-body collapsed">
        <button type="button" class="sb-link" onclick="sbOpenUrl(this, 'å•†å“')">ğŸ›ï¸ å•†å“æƒ…å ±</button>
        <button type="button" class="sb-link" onclick="sbOpenUrl(this, 'é¡§å®¢æƒ…å ±')">ğŸ‘¥ é¡§å®¢æƒ…å ±</button>
        <button type="button" class="sb-link" onclick="sbOpenUrl(this, 'å—æ³¨')">ğŸ“‘ å—æ³¨ã‚·ãƒ¼ãƒˆ</button>
        <button type="button" class="sb-link" onclick="sbOpenUrlDrive(this, 'è¦‹ç©æ›¸')">ğŸ“‹ è¦‹ç©æ›¸</button>
        <button type="button" class="sb-link" onclick="sbOpenUrlDrive(this, 'è«‹æ±‚æ›¸')">ğŸ’° è«‹æ±‚æ›¸</button>
        <button type="button" class="sb-link" onclick="sbOpenUrlDrive(this, 'freeeç´å“æ›¸CSV')">ğŸ“Š freeeç´å“æ›¸CSV</button>
        <button type="button" class="sb-link" onclick="sbOpenUrlDrive(this, 'ç´å“æ›¸')">ğŸ“„ ç´å“æ›¸</button>
        <button type="button" class="sb-link" onclick="sbOpenUrlDrive(this, 'ãƒ¤ãƒãƒˆ')">ğŸšš ãƒ¤ãƒãƒˆé€ã‚ŠçŠ¶</button>
        <button type="button" class="sb-link" onclick="sbOpenUrlDrive(this, 'ä½å·')">ğŸš› ä½å·é€ã‚ŠçŠ¶</button>
      </div>
    </div>
    <? } ?>

    <!-- ãƒ›ãƒ¼ãƒ ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã¯å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤º -->
    <div class="sb-section">
      <div class="sb-header sb-header-util" onclick="toggleSbSection(this)">
        <span>âš™ï¸ ãã®ä»–</span><span class="sb-arrow">â–¼</span>
      </div>
      <div class="sb-body collapsed">
        <button type="button" class="sb-btn" onclick="navTo('mainTop')">ğŸ  ãƒ›ãƒ¼ãƒ ç”»é¢</button>
        <button type="button" class="sb-btn text-danger" onclick="navTo('logout')">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>
  </div>
</div>

<script>
  /* ==============================================
     ã‚µã‚¤ãƒ‰ãƒãƒ¼ JavaScript åˆ¶å¾¡
     ============================================== */
  document.addEventListener('DOMContentLoaded', function () {
    const openBtn = document.getElementById('openSidebarBtn');
    const closeBtn = document.getElementById('closeSidebarBtn');
    const overlay = document.getElementById('sidebarOverlay');
    const menu = document.getElementById('sidebarMenu');

    if (openBtn && closeBtn && overlay && menu) {
      // ç”»é¢ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆh1, h2ç­‰ï¼‰ã®å…ˆé ­ã«ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç§»å‹•
      // ç”»é¢ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆh1, h2ç­‰ï¼‰ã®è¦ªï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ï¼‰ã«ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’é…ç½®
      const headerTitle = document.querySelector('.card-header h1, .card-header h2, .page-hero-header h1, .page-hero-header h2, .container-fluid h1, .container-fluid h2, h2.text-center');
      if (headerTitle) {
        const headerBar = headerTitle.closest('.card-header, .page-hero-header, .container-fluid') || headerTitle;

        // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒ¼ã‚’åŸºæº–ã«ã™ã‚‹
        headerBar.style.display = 'flex';
        headerBar.style.alignItems = 'center';
        headerBar.style.justifyContent = 'center';
        headerBar.style.position = 'relative';
        headerBar.appendChild(openBtn);

        // æ—¢å­˜ã®ã‚¿ã‚¤ãƒˆãƒ«å†…ã‚¢ã‚¤ã‚³ãƒ³ãŒã‚ã‚Œã°éè¡¨ç¤º
        const existingIcon = headerTitle.querySelector('i.bi');
        if (existingIcon) {
          existingIcon.style.display = 'none';
        }

        // ã‚¿ã‚¤ãƒˆãƒ«è‡ªä½“ã®ä½ç½®èª¿æ•´ï¼ˆä¸­å¤®å¯„ã›ã‚’ç¶­æŒï¼‰
        headerTitle.style.display = 'flex';
        headerTitle.style.alignItems = 'center';
        headerTitle.style.justifyContent = 'center';
        headerTitle.style.margin = '0';
      }

      // é–‹ã
      openBtn.addEventListener('click', function (e) {
        e.preventDefault();
        overlay.classList.add('show');
        menu.classList.add('show');
      });

      // é–‰ã˜ã‚‹ (ãƒœã‚¿ãƒ³)
      closeBtn.addEventListener('click', function () {
        overlay.classList.remove('show');
        menu.classList.remove('show');
      });

      // é–‰ã˜ã‚‹ (ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤é ˜åŸŸã‚¯ãƒªãƒƒã‚¯)
      overlay.addEventListener('click', function () {
        overlay.classList.remove('show');
        menu.classList.remove('show');
      });
    }
  });

  // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³é–‹é–‰
  function toggleSbSection(header) {
    const body = header.nextElementSibling;

    if (body.classList.contains('collapsed')) {
      body.classList.remove('collapsed');
      header.classList.remove('collapsed');
    } else {
      body.classList.add('collapsed');
      header.classList.add('collapsed');
    }
  }

  // ç”»é¢é·ç§»ç”¨POSTé€ä¿¡é–¢æ•°
  function navTo(targetName) {
    // ç”»é¢é·ç§»ç”¨ã®å…¨ç”»é¢ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
    let loadingOverlay = document.getElementById('globalSidebarLoading');
    if (!loadingOverlay) {
      loadingOverlay = document.createElement('div');
      loadingOverlay.id = 'globalSidebarLoading';
      loadingOverlay.style.position = 'fixed';
      loadingOverlay.style.top = '0';
      loadingOverlay.style.left = '0';
      loadingOverlay.style.width = '100vw';
      loadingOverlay.style.height = '100vh';
      loadingOverlay.style.backgroundColor = 'rgba(0,0,0,0.5)';
      loadingOverlay.style.zIndex = '9999';
      loadingOverlay.style.display = 'flex';
      loadingOverlay.style.flexDirection = 'column';
      loadingOverlay.style.justifyContent = 'center';
      loadingOverlay.style.alignItems = 'center';

      const spinnerHtml = '<div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;"></div>' +
        '<h5 class="mt-2 text-white">èª­è¾¼ä¸­...</h5>';
      loadingOverlay.innerHTML = spinnerHtml;
      document.body.appendChild(loadingOverlay);
    }
    loadingOverlay.style.display = 'flex';

    const form = document.getElementById('sidebarNavForm');
    const targetInput = document.getElementById('sidebarNavTarget');

    if (form && targetInput) {
      // ç¾åœ¨ã®ç”»é¢ã«ã‚ã‚‹ "prev" ã§å§‹ã¾ã‚‹éš ã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è‡ªå‹•åé›†ã—ã¦è¿½åŠ 
      // (å—æ³¨ä¸€è¦§ã®æ¤œç´¢æ¡ä»¶ãªã©ã‚’å¼•ãç¶™ããŸã‚)
      document.querySelectorAll('input[type="hidden"][name^="prev"]').forEach(el => {
        // æ—¢å­˜ã®åŒåå…¥åŠ›ãŒã‚ã‚Œã°å‰Šé™¤ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
        let existing = form.querySelector(`input[name="${el.name}"]`);
        if (existing) existing.remove();

        // ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã«è¿½åŠ 
        const clone = document.createElement('input');
        clone.type = 'hidden';
        clone.name = el.name;
        clone.value = el.value;
        form.appendChild(clone);
      });

      targetInput.name = targetName;
      form.submit();
    } else {
      console.error('ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
  }

  // ãƒœã‚¿ãƒ³å†…ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åˆ¶å¾¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  let currentActiveBtn = null;
  function setBtnLoading(btn) {
    if (!btn) return;
    btn.disabled = true;
    btn.dataset.original = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true" style="vertical-align: middle;"></span>èª­è¾¼ä¸­...';
    currentActiveBtn = btn;
  }
  function resetBtnLoading() {
    if (!currentActiveBtn || !currentActiveBtn.dataset.original) return;
    currentActiveBtn.innerHTML = currentActiveBtn.dataset.original;
    currentActiveBtn.disabled = false;
    currentActiveBtn = null;
  }

  // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚„ãƒ‰ãƒ©ã‚¤ãƒ–ã®URLã‚’é–‹ãé–¢æ•°ç¾¤
  function sbOpenUrl(btn, sheetName) {
    setBtnLoading(btn);
    if (typeof google !== 'undefined' && google.script && google.script.run) {
      google.script.run.withSuccessHandler(sbSendSuccess).withFailureHandler(sbSendFail).getOpenUrl(sheetName);
    }
  }

  function sbOpenUrlDrive(btn, folderName) {
    setBtnLoading(btn);
    if (typeof google !== 'undefined' && google.script && google.script.run) {
      google.script.run.withSuccessHandler(sbSendSuccess).withFailureHandler(sbSendFail).getOpenUrlDrive(folderName);
    }
  }

  function sbSendSuccess(url) {
    resetBtnLoading();
    if (url) {
      window.open(url, '_blank');
    }
  }

  function sbSendFail() {
    resetBtnLoading();
    // ã™ã§ã« Toast æ©Ÿèƒ½ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å‰æ
    if (typeof showErrorToast === 'function') {
      showErrorToast("URLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    } else {
      alert("URLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
    }
  }
</script>
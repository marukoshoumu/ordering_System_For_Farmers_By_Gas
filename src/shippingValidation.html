<!-- 
  shipping.html ã‹ã‚‰åˆ†é›¢ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ã®JavaScript
  - é€ä¿¡å‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  - ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚§ãƒƒã‚¯
  - è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«
-->
<script>
    /**
     * é€ä¿¡å‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå—æ³¨ç¢ºèªç”»é¢é·ç§»å‰ã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼‰
     *
     * AIè§£æãƒ‡ãƒ¼ã‚¿ã¨å…¥åŠ›å†…å®¹ã‚’æ¯”è¼ƒã—ã€å·®ç•°ã‚„å•é¡ŒãŒã‚ã‚‹å ´åˆã¯è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
     * è­¦å‘ŠãŒãªã„å ´åˆã¯ç¢ºèªç”»é¢ã¸ã®é·ç§»ã‚’è¨±å¯ã—ã¾ã™ã€‚
     *
     * å‡¦ç†ãƒ•ãƒ­ãƒ¼:
     * 1. performLocalCheck()ã§å…¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
     * 2. è­¦å‘Šãªã—: return trueï¼ˆç¢ºèªç”»é¢ã¸é·ç§»ï¼‰
     * 3. è­¦å‘Šã‚ã‚Š: showWarningModal()ã§è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º â†’ return falseï¼ˆé·ç§»ä¸­æ–­ï¼‰
     *
     * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹:
     * - AIè§£æåˆè¨ˆé‡‘é¡ vs å…¥åŠ›åˆè¨ˆé‡‘é¡ã®å·®ç•°ãƒã‚§ãƒƒã‚¯ï¼ˆè¨±å®¹èª¤å·®: Â¥1ï¼‰
     * - AIè§£æå•†å“ vs å…¥åŠ›å•†å“ã®æ•°é‡ãƒ»ä¾¡æ ¼ã®å·®ç•°ãƒã‚§ãƒƒã‚¯
     * - å•†å“ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
     * - ç•°å¸¸æ•°é‡ãƒã‚§ãƒƒã‚¯ï¼ˆ100å€‹ä»¥ä¸Šï¼‰
     *
     * @returns {boolean} true=ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³OKï¼ˆé·ç§»è¨±å¯ï¼‰, false=è­¦å‘Šã‚ã‚Šï¼ˆé·ç§»ä¸­æ–­ï¼‰
     *
     * @see performLocalCheck() - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯æœ¬ä½“
     * @see showWarningModal() - è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
     *
     * å‘¼ã³å‡ºã—å…ƒ: shipping.html ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ï¼ˆonsubmit="return validateBeforeSubmit()"ï¼‰
     */
    function validateBeforeSubmit() {
      const warnings = performLocalCheck();
      if (warnings.length === 0) { return true; }
      showWarningModal(warnings);
      return false;
    }
    
    /**
     * ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œï¼ˆAIè§£æãƒ‡ãƒ¼ã‚¿ã¨å…¥åŠ›å†…å®¹ã®å·®ç•°æ¤œå‡ºï¼‰
     *
     * sessionStorageã«ä¿å­˜ã•ã‚ŒãŸAIè§£æçµæœã¨ç¾åœ¨ã®å…¥åŠ›å†…å®¹ã‚’æ¯”è¼ƒã—ã€
     * å·®ç•°ã‚„å•é¡Œã‚’æ¤œå‡ºã—ã¦è­¦å‘Šé…åˆ—ã‚’è¿”ã—ã¾ã™ã€‚
     *
     * å‡¦ç†ãƒ•ãƒ­ãƒ¼:
     * 1. sessionStorageã‹ã‚‰AIè§£æãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆAI_SESSION_KEYï¼‰
     * 2. AIè§£æãƒ‡ãƒ¼ã‚¿ãªã—: checkBasicValidation()ã®ã¿å®Ÿè¡Œã—ã¦çµ‚äº†
     * 3. AIè§£æãƒ‡ãƒ¼ã‚¿ã‚ã‚Š: ä»¥ä¸‹ã®è©³ç´°ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
     *    a) åˆè¨ˆé‡‘é¡ã®å·®ç•°ãƒã‚§ãƒƒã‚¯ï¼ˆè¨±å®¹èª¤å·®: Â¥1ï¼‰
     *       - å·®ç•° > Â¥1: ğŸ”´ criticalè­¦å‘Š
     *    b) å•†å“ã”ã¨ã®å·®ç•°ãƒã‚§ãƒƒã‚¯ï¼ˆAI_EXCLUDE_CATEGORIES/PRODUCTSé™¤å¤–ï¼‰
     *       - AIè§£æã«ã‚ã‚‹ãŒå…¥åŠ›ãªã—: ğŸŸ¡ warning
     *       - æ•°é‡ãŒç•°ãªã‚‹: ğŸŸ¡ warning
     *       - ä¾¡æ ¼ãŒç•°ãªã‚‹: ğŸŸ¡ warning
     * 4. åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ï¼ˆcheckBasicValidation()ï¼‰
     *
     * è­¦å‘Šã‚¿ã‚¤ãƒ—:
     * - critical (ğŸ”´): åˆè¨ˆé‡‘é¡ã®å·®ç•° - é‡å¤§ãªå…¥åŠ›ãƒŸã‚¹ã®å¯èƒ½æ€§
     * - warning (ğŸŸ¡): æ•°é‡ãƒ»ä¾¡æ ¼ã®å·®ç•°ã€å•†å“ã®æ¬ è½
     * - info (ğŸ’¡): ç•°å¸¸æ•°é‡ãªã©ã€ç¢ºèªã‚’ä¿ƒã™æƒ…å ±
     *
     * AIè§£æãƒ‡ãƒ¼ã‚¿æ§‹é€ :
     * {
     *   totalAmount: 15000,  // AIè§£æåˆè¨ˆé‡‘é¡
     *   items: [
     *     { productName: "å•†å“A", category: "é‡èœ", quantity: 5, price: 1000 },
     *     ...
     *   ]
     * }
     *
     * @returns {Array<Object>} è­¦å‘Šé…åˆ—
     *   å„è­¦å‘Šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ: { type: string, icon: string, title: string, detail: string }
     *
     * @see calculateInputTotal() - å…¥åŠ›åˆè¨ˆé‡‘é¡è¨ˆç®—
     * @see findInputItem() - å…¥åŠ›å•†å“æ¤œç´¢
     * @see checkBasicValidation() - åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
     * @see AI_EXCLUDE_CATEGORIES - é™¤å¤–ã‚«ãƒ†ã‚´ãƒªï¼ˆé€æ–™ãªã©ï¼‰
     * @see AI_EXCLUDE_PRODUCTS - é™¤å¤–å•†å“
     */
    function performLocalCheck() {
      const warnings = [];
      const savedData = sessionStorage.getItem(AI_SESSION_KEY);
      if (!savedData) {
        warnings.push(...checkBasicValidation());
        return warnings;
      }
      const aiData = JSON.parse(savedData);
      const inputTotal = calculateInputTotal();
      if (aiData.totalAmount && Math.abs(aiData.totalAmount - inputTotal) > 1) {
        const diff = inputTotal - aiData.totalAmount;
        warnings.push({ type: 'critical', icon: 'ğŸ”´', title: 'åˆè¨ˆé‡‘é¡ãŒç•°ãªã‚Šã¾ã™', detail: 'AIè§£æ: Â¥' + aiData.totalAmount.toLocaleString() + ' â†’ å…¥åŠ›: Â¥' + inputTotal.toLocaleString() + 'ï¼ˆå·®é¡: ' + (diff >= 0 ? '+' : '') + 'Â¥' + diff.toLocaleString() + 'ï¼‰' });
      }
      if (aiData.items) {
        aiData.items.forEach(aiItem => {
          if (AI_EXCLUDE_CATEGORIES.includes(aiItem.category) || AI_EXCLUDE_PRODUCTS.includes(aiItem.productName)) return;
          const inputItem = findInputItem(aiItem.productName);
          if (!inputItem) {
            warnings.push({ type: 'warning', icon: 'ğŸŸ¡', title: aiItem.productName + ' ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“', detail: 'AIè§£æ: ' + aiItem.quantity + 'å€‹' });
          } else {
            if (inputItem.quantity != aiItem.quantity) {
              warnings.push({ type: 'warning', icon: 'ğŸŸ¡', title: aiItem.productName + ' ã®æ•°é‡ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™', detail: 'AIè§£æ: ' + aiItem.quantity + 'å€‹ â†’ å…¥åŠ›: ' + inputItem.quantity + 'å€‹' });
            }
            if (inputItem.price != aiItem.price) {
              warnings.push({ type: 'warning', icon: 'ğŸŸ¡', title: aiItem.productName + ' ã®ä¾¡æ ¼ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã¾ã™', detail: 'AIè§£æ: Â¥' + (aiItem.price || 0).toLocaleString() + ' â†’ å…¥åŠ›: Â¥' + (inputItem.price || 0).toLocaleString() });
            }
          }
        });
      }
      warnings.push(...checkBasicValidation());
      return warnings;
    }
    
    /**
     * å…¥åŠ›åˆè¨ˆé‡‘é¡è¨ˆç®—ï¼ˆAIè§£æã¨ã®æ¯”è¼ƒç”¨ï¼‰
     *
     * ç¾åœ¨ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå•†å“1ï½10ï¼‰ã‹ã‚‰åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
     * AI_EXCLUDE_CATEGORIESï¼ˆé€æ–™ãªã©ï¼‰ã¨AI_EXCLUDE_PRODUCTSã¯é™¤å¤–ã•ã‚Œã¾ã™ã€‚
     *
     * å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯:
     * 1. å•†å“è¡Œ1ï½10ã‚’ãƒ«ãƒ¼ãƒ—
     * 2. å„è¡Œã‹ã‚‰å•†å“åã€ã‚«ãƒ†ã‚´ãƒªã€ä¾¡æ ¼ã€æ•°é‡ã‚’å–å¾—
     * 3. é™¤å¤–å¯¾è±¡ï¼ˆé€æ–™ã€æ‰‹æ•°æ–™ãªã©ï¼‰ã¯ã‚¹ã‚­ãƒƒãƒ—
     * 4. total += ä¾¡æ ¼ Ã— æ•°é‡
     *
     * é™¤å¤–ã•ã‚Œã‚‹å•†å“ä¾‹:
     * - ã‚«ãƒ†ã‚´ãƒª: "é€æ–™", "æ‰‹æ•°æ–™", "ãã®ä»–"
     * - å•†å“å: "é…é€æ–™", "ä»£å¼•ãæ‰‹æ•°æ–™" ãªã©
     *
     * @returns {number} åˆè¨ˆé‡‘é¡ï¼ˆé™¤å¤–å•†å“ã‚’é™¤ãï¼‰
     *
     * @see performLocalCheck() - ã“ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦AIè§£æã¨æ¯”è¼ƒ
     * @see AI_EXCLUDE_CATEGORIES - é™¤å¤–ã‚«ãƒ†ã‚´ãƒªå®šç¾©ï¼ˆshippingAi.htmlï¼‰
     * @see AI_EXCLUDE_PRODUCTS - é™¤å¤–å•†å“å®šç¾©ï¼ˆshippingAi.htmlï¼‰
     */
    function calculateInputTotal() {
      let total = 0;
      for (let i = 1; i <= 10; i++) {
        const product = document.getElementById('product' + i)?.value || '';
        const category = document.getElementById('bunrui' + i)?.value || '';
        const price = Number(document.getElementById('price' + i)?.value) || 0;
        const quantity = Number(document.getElementById('quantity' + i)?.value) || 0;
        if (AI_EXCLUDE_CATEGORIES.includes(category) || AI_EXCLUDE_PRODUCTS.includes(product)) continue;
        total += price * quantity;
      }
      return total;
    }
    
    /**
     * å…¥åŠ›å•†å“æ¤œç´¢ï¼ˆAIè§£æå•†å“ã¨ã®ç…§åˆç”¨ï¼‰
     *
     * æŒ‡å®šã•ã‚ŒãŸå•†å“åãŒå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå•†å“1ï½10ï¼‰ã«å­˜åœ¨ã™ã‚‹ã‹æ¤œç´¢ã—ã€
     * å­˜åœ¨ã™ã‚‹å ´åˆã¯ä¾¡æ ¼ã¨æ•°é‡ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
     *
     * å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯:
     * 1. å•†å“è¡Œ1ï½10ã‚’ãƒ«ãƒ¼ãƒ—
     * 2. product{i}ã®å€¤ã¨å¼•æ•°productNameã‚’å®Œå…¨ä¸€è‡´ã§æ¯”è¼ƒ
     * 3. ä¸€è‡´ã—ãŸå ´åˆ: å•†å“åã€ä¾¡æ ¼ã€æ•°é‡ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§è¿”ã™
     * 4. ä¸€è‡´ã—ãªã„å ´åˆ: nullè¿”å´
     *
     * @param {string} productName - æ¤œç´¢ã™ã‚‹å•†å“åï¼ˆAIè§£æãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼‰
     * @returns {Object|null} å•†å“æƒ…å ±ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¾ãŸã¯è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯null
     *   è¿”å´ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ: { productName: string, price: number, quantity: number }
     *
     * @see performLocalCheck() - ã“ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦AIè§£æå•†å“ã‚’æ¤œç´¢
     *
     * ä½¿ç”¨ä¾‹:
     * const item = findInputItem("ç™½èœ");
     * // å­˜åœ¨ã™ã‚‹å ´åˆ: { productName: "ç™½èœ", price: 500, quantity: 10 }
     * // å­˜åœ¨ã—ãªã„å ´åˆ: null
     */
    function findInputItem(productName) {
      for (let i = 1; i <= 10; i++) {
        const product = document.getElementById('product' + i)?.value || '';
        if (product === productName) {
          return { productName: product, price: Number(document.getElementById('price' + i)?.value) || 0, quantity: Number(document.getElementById('quantity' + i)?.value) || 0 };
        }
      }
      return null;
    }
    
    /**
     * åŸºæœ¬ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå•†å“é‡è¤‡ã¨ç•°å¸¸æ•°é‡ã®ãƒã‚§ãƒƒã‚¯ï¼‰
     *
     * AIè§£æãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜ã—ãªã„åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
     * å•†å“ã®é‡è¤‡ã¨ç•°å¸¸ã«å¤šã„æ•°é‡ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è­¦å‘Šã‚’è¿”ã—ã¾ã™ã€‚
     *
     * ãƒã‚§ãƒƒã‚¯å†…å®¹:
     * 1. å•†å“é‡è¤‡ãƒã‚§ãƒƒã‚¯
     *    - åŒã˜å•†å“åãŒè¤‡æ•°è¡Œã«å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆ
     *    - è­¦å‘Šã‚¿ã‚¤ãƒ—: warning (ğŸŸ¡)
     *    - æ„å›³: èª¤ã£ã¦åŒã˜å•†å“ã‚’è¤‡æ•°è¡Œã«å…¥åŠ›ã—ãŸå¯èƒ½æ€§
     *
     * 2. ç•°å¸¸æ•°é‡ãƒã‚§ãƒƒã‚¯
     *    - æ•°é‡ãŒ100å€‹ä»¥ä¸Šã®å ´åˆ
     *    - è­¦å‘Šã‚¿ã‚¤ãƒ—: info (ğŸ’¡)
     *    - æ„å›³: æ¡é–“é•ã„ãªã©å…¥åŠ›ãƒŸã‚¹ã®å¯èƒ½æ€§ã‚’ç¢ºèª
     *
     * å‡¦ç†ãƒ•ãƒ­ãƒ¼:
     * 1. å…¨å•†å“è¡Œã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦é‡è¤‡ãƒã‚§ãƒƒã‚¯
     * 2. å…¨å•†å“è¡Œã‚’ãƒ«ãƒ¼ãƒ—ã—ã¦æ•°é‡ãƒã‚§ãƒƒã‚¯ï¼ˆ>=100ï¼‰
     * 3. è­¦å‘Šé…åˆ—ã‚’è¿”å´
     *
     * @returns {Array<Object>} è­¦å‘Šé…åˆ—
     *   å„è­¦å‘Šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ: { type: string, icon: string, title: string, detail: string }
     *
     * @see performLocalCheck() - ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦AIãƒã‚§ãƒƒã‚¯ã«åŸºæœ¬ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
     *
     * è­¦å‘Šä¾‹:
     * - { type: 'warning', icon: 'ğŸŸ¡', title: 'ç™½èœ ãŒé‡è¤‡ã—ã¦ã„ã¾ã™', detail: 'åŒã˜å•†å“ãŒè¤‡æ•°è¡Œã‚ã‚Šã¾ã™' }
     * - { type: 'info', icon: 'ğŸ’¡', title: 'ç™½èœ ã®æ•°é‡ãŒå¤šã„ã§ã™', detail: '150å€‹ - å…¥åŠ›ãƒŸã‚¹ã§ã¯ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„' }
     */
    function checkBasicValidation() {
      const warnings = [];

      // å®šæœŸä¾¿ã®å ´åˆã€ç™ºé€æ—¥ã¨ç´å“æ—¥ã®æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯
      const isRecurringCheckbox = document.getElementById('isRecurringOrder');
      if (isRecurringCheckbox && isRecurringCheckbox.checked) {
        const shippingDate1 = document.querySelector('input[name="shippingDate1"]')?.value || document.getElementById('shippingDate1')?.value;
        const deliveryDate1 = document.querySelector('input[name="deliveryDate1"]')?.value || document.getElementById('deliveryDate1')?.value;

        if (shippingDate1 && deliveryDate1) {
          const shippingDateObj = new Date(shippingDate1);
          const deliveryDateObj = new Date(deliveryDate1);

          if (!isNaN(shippingDateObj.getTime()) && !isNaN(deliveryDateObj.getTime())) {
            if (deliveryDateObj < shippingDateObj) {
              warnings.push({
                type: 'critical',
                icon: 'ğŸ”´',
                title: 'ç´å“æ—¥ãŒç™ºé€æ—¥ã‚ˆã‚Šå‰ã«ãªã£ã¦ã„ã¾ã™',
                detail: 'ç™ºé€æ—¥: ' + shippingDate1 + ' â†’ ç´å“æ—¥: ' + deliveryDate1 + 'ï¼ˆå®šæœŸä¾¿ã®è¨ˆç®—ãŒæ­£ã—ãè¡Œã‚ã‚Œã¾ã›ã‚“ï¼‰'
              });
            }
          }
        }
      }

      const products = [];
      for (let i = 1; i <= 10; i++) {
        const product = document.getElementById('product' + i)?.value || '';
        if (product && products.includes(product)) {
          warnings.push({ type: 'warning', icon: 'ğŸŸ¡', title: product + ' ãŒé‡è¤‡ã—ã¦ã„ã¾ã™', detail: 'åŒã˜å•†å“ãŒè¤‡æ•°è¡Œã‚ã‚Šã¾ã™' });
        }
        if (product) products.push(product);
      }
      for (let i = 1; i <= 10; i++) {
        const product = document.getElementById('product' + i)?.value || '';
        const quantity = Number(document.getElementById('quantity' + i)?.value) || 0;
        if (product && quantity >= 100) {
          warnings.push({ type: 'info', icon: 'ğŸ’¡', title: product + ' ã®æ•°é‡ãŒå¤šã„ã§ã™', detail: quantity + 'å€‹ - å…¥åŠ›ãƒŸã‚¹ã§ã¯ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„' });
        }
      }
      return warnings;
    }
    
    /**
     * è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
     */
    function showWarningModal(warnings) {
      const body = document.getElementById('aiWarningBody');
      body.innerHTML = warnings.map(w => '<div class="ai-warning-item ' + w.type + '"><span class="icon">' + w.icon + '</span><div class="content"><div class="title">' + w.title + '</div><div class="detail">' + w.detail + '</div></div></div>').join('');
      document.getElementById('aiWarningModal').classList.add('show');
    }
    
    /**
     * è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ï¼ˆå…¥åŠ›ç”»é¢ã«æˆ»ã‚‹ï¼‰
     *
     * è¡¨ç¤ºä¸­ã®è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å…¥åŠ›ç”»é¢ã«æˆ»ã—ã¾ã™ã€‚
     * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ[ä¿®æ­£ã™ã‚‹]ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
     *
     * å‡¦ç†:
     * - aiWarningModalã‹ã‚‰'show'ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ï¼ˆCSSãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼‰
     *
     * @see showWarningModal() - ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
     * @see proceedWithWarnings() - è­¦å‘Šã‚’ç„¡è¦–ã—ã¦ç¶šè¡Œã™ã‚‹å ´åˆ
     *
     * å‘¼ã³å‡ºã—å…ƒ: è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã®[ä¿®æ­£ã™ã‚‹]ãƒœã‚¿ãƒ³
     */
    function closeWarningModal() {
      document.getElementById('aiWarningModal').classList.remove('show');
    }
    
    /**
     * è­¦å‘Šã‚’ç¢ºèªã—ã¦ç¶šè¡Œï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ç¢ºèªç”»é¢ã¸é·ç§»ï¼‰
     *
     * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè­¦å‘Šå†…å®¹ã‚’ç¢ºèªã—ãŸä¸Šã§[ã“ã®ã¾ã¾ç¶šè¡Œ]ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
     * validateBeforeSubmit()ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦å¼·åˆ¶çš„ã«ç¢ºèªç”»é¢ã¸é·ç§»ã•ã›ã¾ã™ã€‚
     *
     * å‡¦ç†ãƒ•ãƒ­ãƒ¼:
     * 1. closeWarningModal()ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
     * 2. ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’å–å¾—
     * 3. shippingComfirmãƒœã‚¿ãƒ³ã‚’å–å¾—
     * 4. onclickã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ï¼ˆvalidateBeforeSubmit()ã®å‘¼ã³å‡ºã—ã‚’ç„¡åŠ¹åŒ–ï¼‰
     * 5. btn.click()ã§ç¢ºèªç”»é¢ã¸é·ç§»
     *
     * onclickå‰Šé™¤ã®ç†ç”±:
     * - é€šå¸¸ã€shippingComfirmãƒœã‚¿ãƒ³ã¯ onclick="return validateBeforeSubmit()" ã‚’æŒã¤
     * - ã“ã®onclickãŒå­˜åœ¨ã™ã‚‹ã¨å†åº¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã€å†ã³è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
     * - removeAttribute('onclick')ã§ç„¡åŠ¹åŒ–ã—ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦é·ç§»
     *
     * @see showWarningModal() - è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
     * @see closeWarningModal() - ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
     * @see validateBeforeSubmit() - é€šå¸¸ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
     *
     * å‘¼ã³å‡ºã—å…ƒ: è­¦å‘Šãƒ¢ãƒ¼ãƒ€ãƒ«ã®[ã“ã®ã¾ã¾ç¶šè¡Œ]ãƒœã‚¿ãƒ³
     *
     * ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®:
     * - ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚‚æœ€çµ‚çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨
     * - ã“ã®é–¢æ•°ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã®ã¿
     */
    function proceedWithWarnings() {
      closeWarningModal();
      const form = document.querySelector('form');
      if (form) {
        const btn = document.querySelector('[name="shippingComfirm"]');
        if (btn) {
          btn.removeAttribute('onclick');
          btn.click();
        }
      }
    }
</script>

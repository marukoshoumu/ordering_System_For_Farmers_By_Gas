<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <?!= HtmlService.createHtmlOutputFromFile('design-system').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('components').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('utilities').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('css').getContent(); ?>
</head>

<body>
  <div class="container">
    <form class="mb-5" method="POST" action="<?= deployURL ?>">
      <input type="hidden" name="sessionId" value="<?= typeof sessionId !== 'undefined' ? sessionId : '' ?>">
      <div class="mt-3">
        <button type="submit" formnovalidate class="btn btn-outline-secondary me-3" name="mainTop"
                    value="true">ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹</button>
      </div>
      <h2 class="text-center m-4">è¦‹ç©æ›¸ä½œæˆ</h2>
      <div class="customerSearch_dg">
        <div>
          <label for="customerSearchBunruiDg" class="text-left form-label">é¡§å®¢</label>
          <select class="form-select" id="customerSearchBunruiDg" name="customerSearchBunruiDg">
                        <option value="1">ä¼šç¤¾å</option>
                        <option value="2">æ°å</option>
                        <option value="3">è¡¨ç¤ºå</option>
                        <option value="4">ãƒ•ãƒªã‚¬ãƒŠ</option>
                    </select>
        </div>
        <div>
          <label for="customerSearchClassDg" class="text-left form-label">é¡§å®¢åˆ†é¡</label>
          <select class="form-select" id="customerSearchClassDg" name="customerSearchClassDg">
                        <option value=""></option>
                        <option value="1">ä¸€æ¬¡å¸ã—ãƒ»å¤§å£</option>
                        <option value="2">å°å£²åº—</option>
                        <option value="3">é£²é£Ÿåº—ãƒ»ãƒ›ãƒ†ãƒ«</option>
                        <option value="4">åœ°å…ƒé£²é£Ÿåº—</option>
                        <option value="5">é€šä¿¡è²©å£²</option>
                        <option value="6">ä¸€èˆ¬è²©å£²</option>
                        <option value="7">ãã®ä»–</option>
                        <option value="8">è·åŸŸ</option>
                    </select>
        </div>
        <div>
          <label for="customerSearchKeyDg" class="text-left form-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="text" class="form-control" id="customerSearchKeyDg" name="customerSearchKeyDg">
        </div>
        <div id="resCustArea" class="mt-2 resTable">
        </div>
      </div>
      <div class="shippingToSearch_dg">
        <div>
          <label for="shippingToSearchBunruiDg" class="text-left form-label">ç™ºé€å…ˆ</label>
          <select class="form-select" id="shippingToSearchBunruiDg" name="shippingToSearchBunruiDg">
                        <option value="1">ä¼šç¤¾å</option>
                        <option value="2">æ°å</option>
                    </select>
        </div>
        <div>
          <label for="shippingToSearchKeyDg" class="text-left form-label">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="text" class="form-control" id="shippingToSearchKeyDg" name="shippingToSearchKeyDg">
        </div>
        <div id="resShippingToArea" class="mt-2 resTable">
        </div>
      </div>
      <div class="customer_dg">
        <div>
          <label for="customerClassDg" class="text-left form-label">é¡§å®¢åˆ†é¡</label>
          <select class="form-select" id="customerClassDg" name="customerClassDg">
                        <option value="1">ä¸€æ¬¡å¸ã—ãƒ»å¤§å£</option>
                        <option value="2">å°å£²åº—</option>
                        <option value="3">é£²é£Ÿåº—ãƒ»ãƒ›ãƒ†ãƒ«</option>
                        <option value="4">åœ°å…ƒé£²é£Ÿåº—</option>
                        <option value="5">é€šä¿¡è²©å£²</option>
                        <option value="6">ä¸€èˆ¬è²©å£²</option>
                        <option value="7">ãã®ä»–</option>
                        <option value="8">è·åŸŸ</option>
                    </select>
        </div>
        <div>
          <label for="customerNameDg" class="text-left form-label">ä¼šç¤¾å</label>
          <input type="text" id="customerNameDg" name="customerNameDg">
        </div>
        <div>
          <label for="customerShowNameDg" class="text-left form-label">è¡¨ç¤ºå</label>
          <input type="text" id="customerShowNameDg" name="customerShowNameDg">
        </div>
        <div>
          <label for="customerFuriganaDg" class="text-left form-label">ãƒ•ãƒªã‚¬ãƒŠ</label>
          <input type="text" id="customerFuriganaDg" name="customerFuriganaDg">
        </div>
        <div>
          <label for="customerDepDg" class="text-left form-label">éƒ¨ç½²</label>
          <input type="text" id="customerDepDg" name="customerDepDg">
        </div>
        <div>
          <label for="customerPostDg" class="text-left form-label">å½¹è·</label>
          <input type="text" id="customerPostDg" name="customerPostDg">
        </div>
        <div>
          <label for="customerIdentDg" class="text-left form-label">æ°å</label>
          <input type="text" id="customerIdentDg" name="customerIdentDg">
        </div>
        <div>
          <label for="customerZipcodeDg" class="text-left form-label">éƒµä¾¿ç•ªå·</label>
          <input type="text" id="customerZipcodeDg" name="customerZipcodeDg" maxlength=7
                        onfocusout="getAddress()">
        </div>
        <div>
          <label for="customerAddress1Dg" class="text-left form-label">ä½æ‰€ï¼‘</label>
          <input type="text" id="customerAddress1Dg" name="customerAddress1Dg">
        </div>
        <div>
          <label for="customerAddress2Dg" class="text-left form-label">ä½æ‰€ï¼’</label>
          <input type="text" id="customerAddress2Dg" name="customerAddress2Dg">
        </div>
        <div>
          <label for="customerTelDg" class="text-left form-label">é›»è©±ç•ªå·</label>
          <input type="text" class="form-control" id="customerTelDg" name="customerTelDg" maxlength=11>
        </div>
        <div>
          <label for="customerPhoneDg" class="text-left form-label">æºå¸¯é›»è©±</label>
          <input type="text" class="form-control" id="customerPhoneDg" name="customerPhoneDg" maxlength=11>
        </div>
        <div>
          <label for="customerFaxDg" class="text-left form-label">ï¼¦ï¼¡ï¼¸</label>
          <input type="text" class="form-control" id="customerFaxDg" name="customerFaxDg" maxlength=11>
        </div>
        <div>
          <label for="customerMailDg" class="text-left form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input type="email" class="form-control" id="customerMailDg" name="customerMailDg">
        </div>
        <div class="mt-2 mb-2">
          <input type="checkbox" class="form-check-input" id="customerSameDg" name="customerSameDg">
          <label for="customerSameDg" class="form-check-label">ç™ºé€å…ˆåŒä¸Š</label>
        </div>
        <div>
          <label for="customerBillDg" class="text-left form-label">è«‹æ±‚æ›¸æœ‰ç„¡</label>
          <select class="form-select" id="customerBillDg" name="customerBillDg">
                        <option value=""></option>
                        <option value="æœ‰">æœ‰</option>
                    </select>
        </div>
        <div>
          <label for="customerDepositDateDg" class="text-left form-label">å…¥é‡‘æœŸæ—¥</label>
          <select class="form-select" id="customerDepositDateDg" name="customerDepositDateDg">
                        <option value="ç¿Œæœ«æ—¥">ç¿Œæœ«æ—¥</option>
                        <option value="ï¼’é€±é–“å¾Œ">ï¼’é€±é–“å¾Œ</option>
                        <option value="ç¿Œã€…ä¸­æ—¥">ç¿Œã€…ä¸­æ—¥</option>
                        <option value="ç¿Œã€…æœ«æ—¥">ç¿Œã€…æœ«æ—¥</option>
                    </select>
        </div>
        <div>
          <label for="customerTaxDisplayDg" class="text-left form-label">æ¶ˆè²»ç¨ã®è¡¨ç¤ºæ–¹æ³•</label>
          <select class="form-select" id="customerTaxDisplayDg" name="customerTaxDisplayDg">
            <option value="">ï¼ˆæœªè¨­å®šï¼‰</option>
            <option value="å†…ç¨">å†…ç¨</option>
            <option value="å¤–ç¨">å¤–ç¨</option>
          </select>
        </div>
        <div>
          <label for="customerMemoDg" class="text-left form-label">å‚™è€ƒ</label>
          <input type="text" class="form-control" id="customerMemoDg" name="customerMemoDg">
        </div>
      </div>
      <div>
        <div style="background-color: magenta; color: white; padding: 10px 12px; border-radius: 6px 6px 0 0; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
          <span style="font-weight: 600;">ã€é¡§å®¢æƒ…å ±ã€‘</span>
          <button type='button' class="customerInsertBtn_open btn btn-sm" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 10px; border-radius: 4px;" title="æ–°è¦ç™»éŒ²">â• æ–°è¦</button>
          <button type='button' class="customerSearchBtn_open btn btn-sm" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 10px; border-radius: 4px;" title="é¡§å®¢æ¤œç´¢">ğŸ” æ¤œç´¢</button>
        </div>
        <div>
          <label for="customerName" class="text-left form-label">é¡§å®¢å</label>
          <input type="text" class="form-control" id="customerName" name="customerName" required value="">
        </div>
        <div>
          <label for="shippingToName" class="text-left form-label">ç´å“å ´æ‰€</label>
          <input type="text" class="form-control" id="shippingToName" name="shippingToName" required value="">
        </div>
        <div>
          <label for="deliveryMethod" class="text-left form-label">ç´å“æ–¹æ³•</label>
          <select class="form-select" id="deliveryMethod" name="deliveryMethod" required>
                    </select>
        </div>
        <div>
          <label for="leadTime" class="text-left form-label">å‡ºè·ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ </label>
          <input type="text" class="form-control" id="leadTime" name="leadTime" required value="">
        </div>
        <button type="button" class="btn btn-primary me-3 m-3" id="addProductBtn">å•†å“è¿½åŠ </button>
        <div id="productContainer" class="m-3"></div>
      </div>
      <div class="mb-3">
        <label for="memo" class="text-left form-label">ãã®ä»–ç‰¹è¨˜äº‹é …</label>
        <textarea class="form-control" id="memo" name="memo" rows="3" cols="30"></textarea>
      </div>
      <div class="text-center m-3">
        <button type="button" class="btn btn-primary me-3" id="quoutationComfirm" name="quoutationComfirm"
                    onclick="createQuoutation()">è¦‹ç©æ›¸ä½œæˆ</button>
      </div>
      <p id="res" style="text-align: center;"></p>
      <div class="text-center mt-3">
        <button type="submit" formnovalidate class="btn btn-outline-secondary me-3" name="main"
                    value="true">ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹</button>
      </div>
    </form>
  </div>
  <script>
    // ========================================
    // æ¤œç´¢ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„: ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    // ========================================
    var cachedCustomers = [];
    var masterDataLoaded = false;

    let productsData;
        let bunruisData;
        let unitsData;
        let preservationsData;
        let productContainer;
        let deliveryMethodsData;
        var oriproduct;
        // å•†å“ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
        function addProduct() {
            const productCount = productContainer ? productContainer.children.length + 1 : 1;

            // æ–°ã—ã„å•†å“ç”¨ã®divã‚’ä½œæˆ
            const newProductDiv = document.createElement('div');
            newProductDiv.className = `productDiv row`;
            newProductDiv.id = `productDiv${productCount}`;

            // å•†å“åˆ†é¡ã®ãƒ©ãƒ™ãƒ«ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const bunruiLabel = document.createElement('label');
            bunruiLabel.htmlFor = `bunrui${productCount}`;
            bunruiLabel.textContent = 'å•†å“åˆ†é¡';
            bunruiLabel.className = 'col-form-label';

            const bunruiSelect = document.createElement('select');
            bunruiSelect.className = 'form-select';
            bunruiSelect.id = `bunrui${productCount}`;
            bunruiSelect.name = `bunrui${productCount}`;
            bunruiSelect.addEventListener('change', function () {
                bunruiChange(`${productCount}`);
            });
            const bunruiSelectOption = document.createElement('option');
            bunruiSelectOption.value = '';
            bunruiSelectOption.textContent = '';
            bunruiSelect.appendChild(bunruiSelectOption);

            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            bunruisData.forEach(function (bunrui) {
                const option = document.createElement('option');
                option.value = bunrui['å•†å“åˆ†é¡'];
                option.textContent = bunrui['å•†å“åˆ†é¡'];
                bunruiSelect.appendChild(option);
            });
            // å•†å“åã®ãƒ©ãƒ™ãƒ«ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const productLabel = document.createElement('label');
            productLabel.htmlFor = `product${productCount}`;
            productLabel.textContent = 'å•†å“å';
            productLabel.className = 'col-form-label';

            const productSelect = document.createElement('select');
            productSelect.className = 'form-select';
            productSelect.id = `product${productCount}`;
            productSelect.name = `product${productCount}`;
            const productSelectOption = document.createElement('option');
            productSelectOption.value = '';
            productSelectOption.textContent = '';
            productSelect.appendChild(productSelectOption);

            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            productsData.forEach(function (product) {
                const option = document.createElement('option');
                option.value = product['å•†å“å'];
                option.textContent = product['å•†å“å'];
                option.dataset.val = product['å•†å“åˆ†é¡']
                productSelect.appendChild(option);
            });
            // å†…å®¹é‡ãƒ»è¦æ ¼ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const specLabel = document.createElement('label');
            specLabel.htmlFor = `spec${productCount}`;
            specLabel.textContent = 'å†…å®¹é‡ãƒ»è¦æ ¼';
            specLabel.className = 'col-form-label';

            const specInput = document.createElement('input');
            specInput.className = 'form-control';
            specInput.type = 'text';
            specInput.id = `spec${productCount}`;
            specInput.name = `spec${productCount}`;

            // å‡ºè·ãƒ­ãƒƒãƒˆã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const shipLotLabel = document.createElement('label');
            shipLotLabel.htmlFor = `shipLot${productCount}`;
            shipLotLabel.textContent = 'å‡ºè·ãƒ­ãƒƒãƒˆ';
            shipLotLabel.className = 'col-form-label';

            const shipLotInput = document.createElement('input');
            shipLotInput.className = 'form-control';
            shipLotInput.type = 'text';
            shipLotInput.id = `shipLot${productCount}`;
            shipLotInput.name = `shipLot${productCount}`;

            // å˜ä¾¡ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const priceLabel = document.createElement('label');
            priceLabel.htmlFor = `price${productCount}`;
            priceLabel.textContent = 'å˜ä¾¡ï¼ˆå¤–ç¨ï¼‰';
            priceLabel.className = 'col-form-label';

            const priceInput = document.createElement('input');
            priceInput.className = 'form-control';
            priceInput.type = 'number';
            priceInput.id = `price${productCount}`;
            priceInput.name = `price${productCount}`;
            priceInput.min = 0;

            // å˜ä½ã®ãƒ©ãƒ™ãƒ«ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const unitLabel = document.createElement('label');
            unitLabel.htmlFor = `unit${productCount}`;
            unitLabel.textContent = 'å˜ä½';
            unitLabel.className = 'col-form-label';

            const unitSelect = document.createElement('select');
            unitSelect.className = 'form-select';
            unitSelect.id = `unit${productCount}`;
            unitSelect.name = `unit${productCount}`;
            const unitSelectOption = document.createElement('option');
            unitSelectOption.value = '';
            unitSelectOption.textContent = '';
            unitSelect.appendChild(unitSelectOption);

            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            unitsData.forEach(function (unit) {
                const option = document.createElement('option');
                option.value = unit['å˜ä½'];
                option.textContent = unit['å˜ä½'];
                unitSelect.appendChild(option);
            });
            // ç”£åœ°ï¼ˆè£½é€ å ´æ‰€ï¼‰ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const placeLabel = document.createElement('label');
            placeLabel.htmlFor = `place${productCount}`;
            placeLabel.textContent = 'ç”£åœ°ï¼ˆè£½é€ å ´æ‰€ï¼‰';
            placeLabel.className = 'col-form-label';

            const placeInput = document.createElement('input');
            placeInput.className = 'form-control';
            placeInput.type = 'text';
            placeInput.id = `place${productCount}`;
            placeInput.name = `place${productCount}`;
            // JANã‚³ãƒ¼ãƒ‰ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const jancdLabel = document.createElement('label');
            jancdLabel.htmlFor = `jancd${productCount}`;
            jancdLabel.textContent = 'JANã‚³ãƒ¼ãƒ‰';
            jancdLabel.className = 'col-form-label';

            const jancdInput = document.createElement('input');
            jancdInput.className = 'form-control';
            jancdInput.type = 'text';
            jancdInput.id = `jancd${productCount}`;
            jancdInput.name = `jancd${productCount}`;
            // ä¿å­˜æ¸©åº¦å¸¯ã®ãƒ©ãƒ™ãƒ«ã¨ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const preservationLabel = document.createElement('label');
            preservationLabel.htmlFor = `preservation${productCount}`;
            preservationLabel.textContent = 'ä¿å­˜æ¸©åº¦å¸¯';
            preservationLabel.className = 'col-form-label';

            const preservationSelect = document.createElement('select');
            preservationSelect.className = 'form-select';
            preservationSelect.id = `preservation${productCount}`;
            preservationSelect.name = `preservation${productCount}`;
            const preservationSelectOption = document.createElement('option');
            preservationSelectOption.value = '';
            preservationSelectOption.textContent = '';
            preservationSelect.appendChild(preservationSelectOption);
            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            preservationsData.forEach(function (preservation) {
                const option = document.createElement('option');
                option.value = preservation['ä¿å­˜æ¸©åº¦å¸¯'];
                option.textContent = preservation['ä¿å­˜æ¸©åº¦å¸¯'];
                preservationSelect.appendChild(option);
            });
            // è³å‘³æœŸé™ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const bestEtenLabel = document.createElement('label');
            bestEtenLabel.htmlFor = `bestEten${productCount}`;
            bestEtenLabel.textContent = 'è³å‘³æœŸé™';
            bestEtenLabel.className = 'col-form-label';

            const bestEtenInput = document.createElement('input');
            bestEtenInput.className = 'form-control';
            bestEtenInput.type = 'text';
            bestEtenInput.id = `bestEten${productCount}`;
            bestEtenInput.name = `bestEten${productCount}`;

            // ãã®ä»–ç‰¹è¨˜äº‹é …ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
            const etcLabel = document.createElement('label');
            etcLabel.htmlFor = `etc${productCount}`;
            etcLabel.textContent = 'ãã®ä»–ç‰¹è¨˜äº‹é …';
            etcLabel.className = 'col-form-label';

            const etcInput = document.createElement('input');
            etcInput.className = 'form-control mb-3';
            etcInput.type = 'text';
            etcInput.id = `etc${productCount}`;
            etcInput.name = `etc${productCount}`;
            // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
            const deleteLabel = document.createElement('label');
            deleteLabel.htmlFor = `delete${productCount}`;
            deleteLabel.textContent = `ã€å•†å“${productCount}ã€‘`;
            deleteLabel.className = 'col-form-label col-sm-10';
            const deleteButton = document.createElement('button');
            deleteButton.type = 'button';
            deleteButton.textContent = 'å‰Šé™¤';
            deleteButton.className = 'btn btn-danger';
            deleteButton.id = `delete${productCount}`;
            deleteButton.addEventListener('click', function () {
                productContainer.removeChild(newProductDiv); // ã“ã®å•†å“ã‚’å‰Šé™¤
                updateProductIds();
            });
            const divEle6_1 = document.createElement('div');
            divEle6_1.className = 'col-md-6';
            divEle6_1.appendChild(bunruiLabel);
            divEle6_1.appendChild(bunruiSelect);
            const divEle6_2 = document.createElement('div');
            divEle6_2.className = 'col-md-6';
            divEle6_2.appendChild(productLabel);
            divEle6_2.appendChild(productSelect);
            const divEle6_3_1 = document.createElement('div');
            divEle6_3_1.className = 'col-md-6';
            divEle6_3_1.appendChild(specLabel);
            divEle6_3_1.appendChild(specInput);
            const divEle6_3_2 = document.createElement('div');
            divEle6_3_2.className = 'col-md-6';
            divEle6_3_2.appendChild(shipLotLabel);
            divEle6_3_2.appendChild(shipLotInput);
            const divEle6_3 = document.createElement('div');
            divEle6_3.className = 'col-md-6';
            divEle6_3.appendChild(priceLabel);
            divEle6_3.appendChild(priceInput);
            const divEle6_4 = document.createElement('div');
            divEle6_4.className = 'col-md-6';
            divEle6_4.appendChild(unitLabel);
            divEle6_4.appendChild(unitSelect);
            const divEle6_5 = document.createElement('div');
            divEle6_5.className = 'col-md-6';
            divEle6_5.appendChild(placeLabel);
            divEle6_5.appendChild(placeInput);
            const divEle6_6 = document.createElement('div');
            divEle6_6.className = 'col-md-6';
            divEle6_6.appendChild(jancdLabel);
            divEle6_6.appendChild(jancdInput);
            const divEle6_7 = document.createElement('div');
            divEle6_7.className = 'col-md-6';
            divEle6_7.appendChild(preservationLabel);
            divEle6_7.appendChild(preservationSelect);
            const divEle6_8 = document.createElement('div');
            divEle6_8.className = 'col-md-6';
            divEle6_8.appendChild(bestEtenLabel);
            divEle6_8.appendChild(bestEtenInput);
            const divEle12_1 = document.createElement('div');
            divEle12_1.className = 'col-12';
            divEle12_1.appendChild(etcLabel);
            divEle12_1.appendChild(etcInput);
            const divDelteEle = document.createElement('div');
            divDelteEle.className = 'row mt-3';
            divDelteEle.appendChild(deleteLabel);
            const divEle2_1 = document.createElement('div');
            divEle2_1.className = 'col-sm-2';
            divEle2_1.appendChild(deleteButton);
            divDelteEle.appendChild(divEle2_1);
            // newProductDivã«ã™ã¹ã¦ã®è¦ç´ ã‚’è¿½åŠ 
            const newline = document.createElement('hr');
            newProductDiv.appendChild(newline);
            newProductDiv.appendChild(divDelteEle);
            newProductDiv.appendChild(divEle6_1);
            newProductDiv.appendChild(divEle6_2);
            newProductDiv.appendChild(divEle6_3_1);
            newProductDiv.appendChild(divEle6_3_2);
            newProductDiv.appendChild(divEle6_3);
            newProductDiv.appendChild(divEle6_4);
            newProductDiv.appendChild(divEle6_5);
            newProductDiv.appendChild(divEle6_6);
            newProductDiv.appendChild(divEle6_7);
            newProductDiv.appendChild(divEle6_8);
            newProductDiv.appendChild(divEle12_1);

            // productContainerã«æ–°ã—ã„å•†å“ã‚’è¿½åŠ 
            productContainer.appendChild(newProductDiv);
        }

        // å•†å“IDã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateProductIds() {
            const products = document.querySelectorAll('.productDiv'); // å•†å“ã‚’å…¨ã¦å–å¾—
            products.forEach((product, index) => {
                const idNumber = index + 1; // IDã‚’1ã‹ã‚‰å§‹ã¾ã‚‹é€£ç•ªã«ã™ã‚‹
                product.querySelectorAll('label')[0].htmlFor = `delete${idNumber}`;
                product.querySelectorAll('label')[0].textContent = `ã€å•†å“${idNumber}ã€‘`;
                product.querySelectorAll('button')[0].id = `delete${idNumber}`;
                // å•†å“åˆ†é¡
                product.querySelectorAll('label')[1].htmlFor = `bunrui${idNumber}`;
                product.querySelectorAll('select')[0].id = `bunrui${idNumber}`;
                product.querySelectorAll('select')[0].name = `bunrui${idNumber}`;
                // å•†å“å
                product.querySelectorAll('label')[2].htmlFor = `product${idNumber}`;
                product.querySelectorAll('select')[1].id = `product${idNumber}`;
                product.querySelectorAll('select')[1].name = `product${idNumber}`;
                // å†…å®¹é‡ãƒ»è¦æ ¼
                product.querySelectorAll('label')[3].htmlFor = `spec${idNumber}`;
                product.querySelectorAll('input')[0].id = `spec${idNumber}`;
                product.querySelectorAll('input')[0].name = `spec${idNumber}`;
                // å‡ºè·ãƒ­ãƒƒãƒˆ
                product.querySelectorAll('label')[4].htmlFor = `shipLot${idNumber}`;
                product.querySelectorAll('input')[1].id = `shipLot${idNumber}`;
                product.querySelectorAll('input')[1].name = `shipLot${idNumber}`;
                // å˜ä¾¡
                product.querySelectorAll('label')[5].htmlFor = `price${idNumber}`;
                product.querySelectorAll('input')[2].id = `price${idNumber}`;
                product.querySelectorAll('input')[2].name = `price${idNumber}`;
                // å˜ä½
                product.querySelectorAll('label')[6].htmlFor = `unit${idNumber}`;
                product.querySelectorAll('select')[2].id = `unit${idNumber}`;
                product.querySelectorAll('select')[2].name = `unit${idNumber}`;
                // ç”£åœ°ï¼ˆè£½é€ å ´æ‰€ï¼‰
                product.querySelectorAll('label')[7].htmlFor = `place${idNumber}`;
                product.querySelectorAll('input')[3].id = `palce${idNumber}`;
                product.querySelectorAll('input')[3].name = `palce${idNumber}`;
                // JANã‚³ãƒ¼ãƒ‰
                product.querySelectorAll('label')[8].htmlFor = `jancd${idNumber}`;
                product.querySelectorAll('input')[4].id = `jancd${idNumber}`;
                product.querySelectorAll('input')[4].name = `jancd${idNumber}`;
                // ä¿å­˜æ¸©åº¦å¸¯
                product.querySelectorAll('label')[9].htmlFor = `preservation${idNumber}`;
                product.querySelectorAll('select')[3].id = `preservation${idNumber}`;
                product.querySelectorAll('select')[3].name = `preservation${idNumber}`;
                // è³å‘³æœŸé™
                product.querySelectorAll('label')[10].htmlFor = `bestEten${idNumber}`;
                product.querySelectorAll('input')[5].id = `bestEten${idNumber}`;
                product.querySelectorAll('input')[5].name = `bestEten${idNumber}`;
                // ãã®ä»–ç‰¹è¨˜äº‹é …
                product.querySelectorAll('label')[11].htmlFor = `etc${idNumber}`;
                product.querySelectorAll('input')[6].id = `etc${idNumber}`;
                product.querySelectorAll('input')[6].name = `etc${idNumber}`;
            });
        }
        function loadProducts() {
            google.script.run.withSuccessHandler(function (data) {
                productContainer = document.getElementById('productContainer');
                var res = JSON.parse(data);
                bunruisData = res[0].bunruis;
                productsData = res[0].products;
                unitsData = res[0].units;
                preservationsData = res[0].preservations;
                deliveryMethodsData = res[0].deliveryMethods;

                // åˆæœŸåŒ–ã¨ã—ã¦æœ€åˆã®å•†å“ã‚’è¿½åŠ 
                addProduct();
                const deliveryMethod = document.getElementById('deliveryMethod');
                const defOption = document.createElement('option');
                defOption.value = '';
                defOption.textContent = '';
                deliveryMethod.appendChild(defOption);
                deliveryMethodsData.forEach(function (deliveryMethods) {
                    const option = document.createElement('option');
                    option.value = deliveryMethods['ç´å“æ–¹æ³•'];
                    option.textContent = deliveryMethods['ç´å“æ–¹æ³•'];
                    deliveryMethod.appendChild(option);
                });
                oriproduct = $('select[id="product1"]').html();
                // ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§å•†å“ã‚’è¿½åŠ 
            }).getQuotations();
        }

        document.addEventListener('DOMContentLoaded', loadProducts);
        document.getElementById('addProductBtn').addEventListener('click', addProduct);
        function bunruiChange(numVal) {
            var bunrui = 'bunrui' + numVal;
            var product = 'product' + numVal;
            var $product = $('select[id="' + product + '"]');
            var val1 = $('select[id="' + bunrui + '"]').val();
            $product.html(oriproduct).find('option').each(function () {
                var val2 = $(this).data('val');
                if (val1 && val1 != val2) {
                    $(this).not(':first-child').remove();
                }
            })
        }
        $(function () {
            $(".customerInsertBtn_open").on("click", function () {
                $(".customer_dg").dialog({
                    title: "é¡§å®¢æ–°è¦ç™»éŒ²",
                    height: "500",
                    modal: true,
                    buttons: {
                        "ã‚­ãƒ£ãƒ³ã‚»ãƒ«": function () {
                            $(this).dialog("close");
                        },
                        "ç™»éŒ²": function () {
                            addCustomer();
                        },
                    },
                });
            });
        });
        function addCustomer() {
            if (!$('input[id="customerNameDg"]').val() && !$('input[id="customerIdentDg"]').val()) {
                showWarningToast('ä¼šç¤¾åã¾ãŸã¯æ°åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('input[id="customerZipcodeDg"]').val()) {
                showWarningToast('éƒµä¾¿ç•ªå·ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('input[id="customerZipcodeDg"]').val().match(/[0-9]{7}/)) {
                showWarningToast('éƒµä¾¿ç•ªå·ã¯7æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚');
                return false;
            }
            if (!$('input[id="customerAddress1Dg"]').val()) {
                showWarningToast('ä½æ‰€ï¼‘ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('input[id="customerTelDg"]').val()) {
                showWarningToast('é›»è©±ç•ªå·ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('input[id="customerTelDg"]').val().match(/^0\d{9,10}$/)) {
                showWarningToast('é›»è©±ç•ªå·ã¯10~11æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚');
                return false;
            }
            if ($('input[id="customerPhoneDg"]').val()) {
                if (!$('input[id="customerPhoneDg"]').val().match(/^0\d{9,10}$/)) {
                    showWarningToast('æºå¸¯é›»è©±ã¯10~11æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚');
                    return false;
                }
            }
            if ($('input[id="customerFaxDg"]').val()) {
                if (!$('input[id="customerFaxDg"]').val().match(/^0\d{9,10}$/)) {
                    showWarningToast('ï¼¦ï¼¡ï¼¸ã¯10~11æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚');
                    return false;
                }
            }
            if ($('input[id="customerMailDg"]').val()) {
                if (!$('input[id="customerMailDg"]').val().match(/^([a-zA-Z0-9])+([a-zA-Z0-9\._-])*@([a-zA-Z0-9_-])+([a-zA-Z0-9\._-]+)+$/)) {
                    showWarningToast('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ­£ã—ã„å½¢å¼ã§å…¥åŠ›ã—ã¦ä¸‹ã•ã„ã€‚');
                    return false;
                }
            }
            var record = {};
            record['customerClassDg'] = $('select[id="customerClassDg"]').val();
            record['customerNameDg'] = $('input[id="customerNameDg"]').val();
            record['customerShowNameDg'] = $('input[id="customerShowNameDg"]').val();
            record['customerFuriganaDg'] = $('input[id="customerFuriganaDg"]').val();
            record['customerDepDg'] = $('input[id="customerDepDg"]').val();
            record['customerPostDg'] = $('input[id="customerPostDg"]').val();
            record['customerIdentDg'] = $('input[id="customerIdentDg"]').val();
            record['customerZipcodeDg'] = $('input[id="customerZipcodeDg"]').val();
            record['customerAddress1Dg'] = $('input[id="customerAddress1Dg"]').val();
            record['customerAddress2Dg'] = $('input[id="customerAddress2Dg"]').val();
            record['customerTelDg'] = $('input[id="customerTelDg"]').val();
            record['customerPhoneDg'] = $('input[id="customerPhoneDg"]').val();
            record['customerFaxDg'] = $('input[id="customerFaxDg"]').val();
            record['customerMailDg'] = $('input[id="customerMailDg"]').val();
            record['customerBillDg'] = $('select[id="customerBillDg"]').val();
            record['customerDepositDateDg'] = $('select[id="customerDepositDateDg"]').val();
            record['customerTaxDisplayDg'] = $('select[id="customerTaxDisplayDg"]').val();
            record['customerMemoDg'] = $('input[id="customerMemoDg"]').val();

            const checkAddFlg = window.confirm('é¡§å®¢æƒ…å ±ã‚’ç™»éŒ²ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');
            if (checkAddFlg) {
                if ($('input[name=customerSameDg]').prop("checked")) {
                    google.script.run.withSuccessHandler(dataAddSuccess).withFailureHandler(dataAddFail).addCustomerShippingTo(JSON.stringify(record));
                }
                else {
                    google.script.run.withSuccessHandler(dataAddSuccess).withFailureHandler(dataAddFail).addCustomer(JSON.stringify(record));
                }
            }
        }
        function getAddress() {
            var postalCode = document.getElementById("customerZipcodeDg").value;
            var record = {};
            record['postalCode'] = postalCode;
            google.script.run.withSuccessHandler(dataPostSuccess).withFailureHandler(addFail).getAddressFromPostalCode(JSON.stringify(record));
        }

        function dataPostSuccess(data) {
            if (data) {
                var res = JSON.parse(data);
                $('input[id="customerAddress1Dg"]').val(res['address1'] + res['address2'] + res['address3']);
            }
        }
        function dataAddFail() {
            showInfoToast("è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
        }
        function addFail() {
            showErrorToast("å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }

        function dataAddSuccess() {
            showSuccessToast("ç™»éŒ²ã—ã¾ã—ãŸã€‚");
            if ($('input[id="customerNameDg"]').val()) {
                $('input[id="customerName"]').val($('input[id="customerNameDg"]').val() + "ã€€" + $('input[id="customerIdentDg"]').val());
            }
            else {
                $('input[id="customerName"]').val($('input[id="customerIdentDg"]').val());
            }
            $(".customer_dg").dialog("close");
        }
        // é¡§å®¢æ¤œç´¢ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ãï¼ˆã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ã§å‹•çš„è¦ç´ ã«å¯¾å¿œï¼‰
        $(document).on("click", ".customerSearchBtn_open", function () {
            $(".customerSearch_dg").dialog({
                title: "é¡§å®¢æ¤œç´¢",
                width: "400",
                height: "500",
                modal: true,
                buttons: {
                    "ã‚­ãƒ£ãƒ³ã‚»ãƒ«": function () {
                        $(this).dialog("close");
                    },
                    "æ¤œç´¢": function () {
                        customerSearch();
                    },
                },
            });
        });
        function customerSearch() {
            if (!$('input[id="customerSearchKeyDg"]').val()) {
                showWarningToast('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }

            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯æ—§æ–¹å¼ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (!masterDataLoaded) {
              console.warn('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿æœªãƒ­ãƒ¼ãƒ‰ - æ—§æ–¹å¼ã§æ¤œç´¢ã—ã¾ã™');
              $("#resCustArea").html('<div class="inline-spinner"><div class="mini-spinner"></div><span>æ¤œç´¢ä¸­...</span></div>');
              var record = {};
              record['customerSearchBunruiDg'] = $('select[id="customerSearchBunruiDg"]').val();
              record['customerSearchClassDg'] = $('select[id="customerSearchClassDg"]').val();
              record['customerSearchKeyDg'] = $('input[id="customerSearchKeyDg"]').val();
              google.script.run.withSuccessHandler(dataSearchSuccess).withFailureHandler(dataAddFail).customerSearch(JSON.stringify(record));
              return;
            }

            // ãƒ¡ãƒ¢ãƒªå†…ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆé«˜é€Ÿæ¤œç´¢ï¼‰
            var bunrui = $('select[id="customerSearchBunruiDg"]').val();
            var searchClass = $('select[id="customerSearchClassDg"]').val();
            var key = $('input[id="customerSearchKeyDg"]').val();

            var results = cachedCustomers.filter(function(customer) {
              // é¡§å®¢åˆ†é¡ãƒ•ã‚£ãƒ«ã‚¿
              if (searchClass && customer['é¡§å®¢åˆ†é¡'] !== searchClass) {
                return false;
              }

              // æ¤œç´¢å¯¾è±¡ã‚«ãƒ©ãƒ ã‚’æ±ºå®š
              var targetValue = '';
              if (bunrui == "1") {
                targetValue = customer['ä¼šç¤¾å'] || '';
              } else if (bunrui == "2") {
                targetValue = customer['æ°å'] || '';
              } else if (bunrui == "3") {
                targetValue = customer['è¡¨ç¤ºå'] || '';
              } else if (bunrui == "4") {
                targetValue = customer['ãƒ•ãƒªã‚¬ãƒŠ'] || '';
              }

              // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
              return String(targetValue).includes(key);
            });

            // çµæœã‚’è¡¨ç¤º
            dataSearchSuccess(JSON.stringify(results));
        }

        function escapeHtml(str) {
            if (str == null) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }
        function dataSearchSuccess(datas) {
            var res = JSON.parse(datas);
            if (res && res.length > 0) {
                var html = "<table>";
                html += "<tr><th></th><th>ä¼šç¤¾å</th><th>æ°å</th></tr>";
                for (let i = 0; i < res.length; i++) {
                    var ec = escapeHtml(res[i]["ä¼šç¤¾å"] || '');
                    var ep = escapeHtml(res[i]["æ°å"] || '');
                    var ez = escapeHtml(res[i]["éƒµä¾¿ç•ªå·"] || '');
                    var ea1 = escapeHtml(res[i]["ä½æ‰€ï¼‘"] || '');
                    var ea2 = escapeHtml(res[i]["ä½æ‰€ï¼’"] || '');
                    var et = escapeHtml(res[i]["TEL"] || '');
                    var datVal = ec + "|" + ep + "|" + ez + "|" + ea1 + ea2 + "|" + et;
                    html += "<tr>";
                    html += "<td><button type='button' id='nameCust" + i + "' data-val='" + datVal + "' onclick='applyName(" + i + ")'>é¸æŠ</button></td>";
                    html += "<td><input style='width:120px;' type='text' id='cust" + i + "' value='" + ec + "' readonly></td>";
                    html += "<td><input style='width:120px;' type='text' id='ident" + i + "' value='" + ep + "' readonly></td>";
                    html += "</tr>";
                }
                html += "</table>";
                $("#resCustArea").html(html);
            }
            else {
                showInfoToast('è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
                $("#resCustArea").html('');
            }
        }
        function applyName(num) {
            var nameVal = 'nameCust' + num;
            var dataVal = $('button[id="' + nameVal + '"]').data('val');
            var dataSp = dataVal.split('|');
            $(".customerSearch_dg").dialog("close");
            if (dataSp[0]) {
                $('input[id="customerName"]').val(dataSp[0] + "ã€€" + dataSp[1]);
            }
            else {
                $('input[id="customerName"]').val(dataSp[1]);
            }
        }
        function setProductSearch() {
            if (!$('input[id="customerName"]').val()) {
                showWarningToast('é¡§å®¢åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            $("button[id='productSearch']").html('<span class="btn-spinner"></span> æ¤œç´¢ä¸­...');
            var customerName = $('input[id="customerName"]').val();
            google.script.run.withSuccessHandler(setDataList).withFailureHandler(dataAddFail).getLastData(customerName);

        }
        function createQuoutation() {
            if (!$('input[id="customerName"]').val()) {
                showWarningToast('é¡§å®¢åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('input[id="shippingToName"]').val()) {
                showWarningToast('ç´å“å ´æ‰€ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('select[id="deliveryMethod"]').val()) {
                showWarningToast('ç´å“æ–¹æ³•ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            if (!$('input[id="leadTime"]').val()) {
                showWarningToast('å‡ºè·ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return false;
            }
            const products = document.querySelectorAll('.productDiv'); // å•†å“ã‚’å…¨ã¦å–å¾—
            if (products.length < 1) {
                showWarningToast('å•†å“ãŒï¼‘ä»¶ã‚‚å­˜åœ¨ã—ã¾ã›ã‚“ã€‚');
                return false;
            }
            for (let i = 1; i <= products.length; i++) {
                if (!$('select[id="bunrui' + `${i}` + '"]').val()) {
                    showWarningToast('å•†å“åˆ†é¡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                    return false;
                }
                if (!$('select[id="product' + `${i}` + '"]').val()) {
                    showWarningToast('å•†å“åãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                    return false;
                }
                if (!$('input[id="price' + `${i}` + '"]').val()) {
                    showWarningToast('å˜ä¾¡ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                    return false;
                }
                if (!$('select[id="unit' + `${i}` + '"]').val()) {
                    showWarningToast('å˜ä½ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                    return false;
                }
            }

            const checkAddFlg = window.confirm('è¦‹ç©æ›¸ã‚’ç™ºè¡Œã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');
            if (checkAddFlg) {
                $("button[id='quoutationComfirm']").text('ä½œæˆä¸­ï¼ï¼ï¼');
                var record = {};
                record['customerName'] = $('input[id="customerName"]').val();
                record['shippingToName'] = $('input[id="shippingToName"]').val();
                record['deliveryMethod'] = $('select[id="deliveryMethod"]').val();
                record['leadTime'] = $('input[id="leadTime"]').val();
                record['memo'] = $('textarea[id="memo"]').val();
                let productData = [];
                for (let i = 1; i <= products.length; i++) {
                    const rec = {};
                    rec['bunrui'] = $('select[id="bunrui' + `${i}` + '"]').val();
                    rec['product'] = $('select[id="product' + `${i}` + '"]').val();
                    rec['spec'] = $('input[id="spec' + `${i}` + '"]').val();
                    rec['shipLot'] = $('input[id="shipLot' + `${i}` + '"]').val();
                    rec['price'] = $('input[id="price' + `${i}` + '"]').val();
                    rec['unit'] = $('select[id="unit' + `${i}` + '"]').val();
                    rec['place'] = $('input[id="place' + `${i}` + '"]').val();
                    rec['jancd'] = $('input[id="jancd' + `${i}` + '"]').val();
                    rec['preservation'] = $('select[id="preservation' + `${i}` + '"]').val();
                    rec['bestEten'] = $('input[id="bestEten' + `${i}` + '"]').val();
                    rec['etc'] = $('input[id="etc' + `${i}` + '"]').val();
                    productData.push(rec);
                }
                record['products'] = productData;
                google.script.run.withSuccessHandler(createQuoutationSuccess).withFailureHandler(createQuoutationFail).createQuoutation(JSON.stringify(record));
            }
        }
        function createQuoutationSuccess(data) {
            if (data) {
                showSuccessToast("è¦‹ç©æ›¸ã‚’ä½œæˆã—ã¾ã—ãŸã€‚");
                $("button[id='quoutationComfirm']").text('è¦‹ç©æ›¸ä½œæˆ');
                var html = "â—†ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«â—†<br>";
                html += data + ".pdf" + "<br>";
                $("p[id='res']").html(html);
            }
            else {
                showInfoToast("è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
                $("button[id='quoutationComfirm']").text('è¦‹ç©æ›¸ä½œæˆ');
            }
        }
        function createQuoutationFail() {
            showErrorToast("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
            $("button[id='quoutationComfirm']").text('è¦‹ç©æ›¸ä½œæˆ');
        }

        // ========================================
        // æ¤œç´¢ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„: ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰
        // ========================================
        function loadMasterDataForSearch() {
          console.log('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...');
          google.script.run
            .withSuccessHandler(function(data) {
              try {
                const masterData = JSON.parse(data);
                cachedCustomers = masterData.customers || [];
                masterDataLoaded = true;
                console.log('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰å®Œäº†:', cachedCustomers.length + 'ä»¶ã®é¡§å®¢');
              } catch (e) {
                console.error('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—:', e);
              }
            })
            .withFailureHandler(function(e) {
              console.error('ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—:', e);
            })
            .getAllMasterDataForSearch();
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        loadMasterDataForSearch();
  </script>
  <?!= HtmlService.createHtmlOutputFromFile('keyCheck').getContent(); ?>
</body>

</html>